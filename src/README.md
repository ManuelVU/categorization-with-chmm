# Source code

Files in this section include functions to generate read and write data files 
(`~/data-f`), calculate similarities (`~/similarity-f`) and sampling methods 
(`~/sampling-f`). Functions are used by files in the `~/analysis` directory.

----

### Data functions

The directory `~/data-f` contains functions that read and write data from the 
experiments in the project. Original data are stored in `.mat` format on 
`~/data/matlab-files`.

  - `lee-navarro-rw.R` this function reads data from Lee and Navarro's 2002 
  and saves the output in long format as a `.csv` file into the 
  `~data/csv-files` directory.
  
  - `lewandowsky-rw.R` this function reads data from Lewandowsky's 2011 
  and saves the output in long format as a `.csv` file into the 
  `~data/csv-files` directory.
  
----

### Similarity functions

The directory `~/similarity-f` contains functions that can write 
stimulus-features data files in `.csv` format and functions to calculate the 
similarity between two stimulus in an experiment. This functions are used by 
the sampling methods in `~/sampling-f`.

  - `lee-navarro-features.R` function that writes a data-frame in `.csv` with 
  the stimulus, stimulus name, and features in terms of their presence/absence,
  for Lee and Navarro's 2002 experiment.
  
  - `lewandowsky-features.R` function that writes a data-frame in `.csv` with 
  the stimulus, stimulus name, and features in terms of their presence/absence,
  for Lewandowsky's 2011 experiment.

  - `lee-navarro-distinctive.R` function that takes a stimulus feature matrix 
  and returns a three-dimensional array with the features in stimulus I that 
  are not shared by J and the features in stimulus J not shared by I. Stimulus
  I is considered the target and J is the comparison stimulus. Function returns
  a list with two three-dimensional arrays `i_not_in_j` and `not_in_i_in_j`, the
  third dimension indexes the target stimulus I, rows index the comparison
  stimulus J and columns the feature according to the `stimulus` variable in the 
  stimulus feature matrix provided to the function.
  
  - `featural-distance.R` function that calculates the feature distance of a 
  target stimulus I (rows) and a comparison stimulus J (columns). Function takes
  two arguments, a distinctive features array generated by the function in
  `lee-navarro-distinctive.R`, and a salience vector that indexes the weight of
  each feature dimension, this vector needs to have as many elements as 
  the number of stimulus features on a given experiment. The output is a 
  symmetric dissimilarity matrix. This measure is based on Lee and Navarro's 
  (2002) equation 12.
  
  - `similarity.R` function that calculates the similarity between stimulus i
  and j for a given decay_rate and decay_function which represent the speed at
  which similarity decays with distance and the function of that decay. Function
  takes 3 arguments, a decay_rate, a decay_function value and a distance matrix.
  currently can only take a symmetric matrix based on Lee and Navarro's fetural
  distance measure.
  
----

### Sampling functions

The directory `~/sampling-f` contains functions used by the sampling methods 
that are specific to CHMM process. Functions are called in by the code used for 
data analysis in the `~/analysis` directory.

  - `logit.R` function that takes a value x and returns the logit of x, defined
  as $$\frac{1}{1+e^{-x}}.$$

  - `transition_others.R` function that computes the product of the transition
  probabilities of all other chains except the one currently being updated. The
  function takes 6 arguments: the states of all other chains except the one 
  being updated at the current trial (state_now) and the next trial 
  (state_after), a symmetric similarity matrix (similarity), the id of the 
  stimulus that is currently being updated (current_id), an inertia parameter 
  in favor of category A (alpha) and an inertia parameter in favor of category 
  B (beta).
  
  - `ffbs.R` forward filter backward sample algorithm, the function takes a 
  stimulus id (update_stimulus_id), a set of unobserved states 
  (unobserved_states) and a vector of responses (responses) and calculates the 
  conditional filtered probabilities used in by the backward sample algorithm 
  to generate a posterior sample of the states chain associated with the 
  stimulus being updated. The function also requires the following data:
  a symmetric similarity matrix (similarity; used by the `transition_others.R` 
  function), the number of possible states a chain can take (n_states), a value
  for the response error parameter (response_error), an initial probability 
  of size equal to the number of states minus one, an inertia parameter in 
  favor of category A and one for category B. The function returns a sample of 
  the unobserved states for the given stimulus and the sum of the log-likelihood 
  for the sequence in the form of a list.

----

TO DO

Need a function that can update all stimulus unobserved values in a single 
pass using the ffbs function, then we could do some parallel computing using 
that function.

Function that computes the gradient from the two inertia parameters in the 
model. This function will be used by the Hamiltonian algorithm in order to 
generate proposals.

Hamiltonian Monte Carlo function that generates samples for the inertia 
parameters in the model (needs gradient and and posterior density functions).
